<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DocChat | Kyojin AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-custom navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">
      <img src="/static/assets/img/kyojin-logo.png" alt="Kyojin AI Logo" height="60" width="170" style="filter: invert(1);">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mb-2 mb-lg-0 center-navbar">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle active" href="#" role="button"
             data-bs-toggle="dropdown" aria-expanded="false">
            Tools
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">ResearchPilot</a></li>
            <li><a class="dropdown-item active" href="/docchat">DocChat</a></li>
            <li><a class="dropdown-item" href="#">PaperQuery</a></li>
            <li><a class="dropdown-item" href="#">Code Assistant</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">About</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


<div class="container" style="margin-top: 0; padding-top: 0;">
  <h1 style="font-family: 'Inter', sans-serif;">DocChat</h1>
    <p class="lead text-center">
        Upload your Docs and Chat with them...<br>
        using an AI built for Researchers and Academics.
    </p>



  <div class="row">
    <!-- Chat Section (Left) -->
    <div class="col-lg-7 mb-4">
      <div class="card shadow-sm mb-3 bg-dark text-white" style="height: 400px; overflow-y: auto;" id="chat-box">
        <div class="card-body" id="messages">
          <h6 class="text-center mb-3 text-white" style="font-weight: bold;">ragbot-v1</h6>
          <!-- Messages appear here -->
        </div>
      </div>

      <form id="chat-form">
        <div class="input-group">
          <input type="text" id="user-input" class="form-control bg-medium" placeholder="Type your question..." autocomplete="off" required>
          <button class="btn btn-primary" type="submit">Send</button>
        </div>
      </form>
    </div>

    <!-- Upload Section (Right) -->
    <div class="col-lg-5">

      <div class="card shadow-sm p-3 bg-dark text-white">
        <h5>Upload Your Files</h5>
        <form id="upload-form" enctype="multipart/form-data" method="post">
          <div class="mb-3">
            <input class="form-control" type="file" id="file-input" name="file" multiple required>
          </div>
          <button class="btn btn-success" type="submit">Upload</button>
        </form>
        <div id="upload-status" class="mt-2 text-muted"></div>
      </div>

    </div>
  </div>
</div>


<script>
  const form = document.getElementById('chat-form');
  const input = document.getElementById('user-input');
  const messages = document.getElementById('messages');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const userMessage = input.value.trim();
    if (!userMessage) return;

    // Display user message
    messages.innerHTML += `<div class="text-end mb-2"><span class="badge bg-primary">${userMessage}</span></div>`;
    input.value = '';

    // Placeholder bot response (replace with actual fetch to API later)
    messages.innerHTML += `<div class="text-start mb-2"><span class="badge bg-secondary">Processing...</span></div>`;

    // Auto-scroll to bottom
    document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;

    // TODO: Replace below with real API call
    setTimeout(() => {
      const botReply = "This is a placeholder response.";
      const allMsgs = messages.querySelectorAll('.badge.bg-secondary');
      allMsgs[allMsgs.length - 1].innerText = botReply;
    }, 1000);
  });
</script>

<script>
  const uploadForm = document.getElementById('upload-form');
  const uploadStatus = document.getElementById('upload-status');

  uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fileInput = document.getElementById('file-input');
    const formData = new FormData();

    for (let file of fileInput.files) {
      formData.append("files", file); // use 'files' for multiple files
    }

    uploadStatus.innerText = "Uploading...";

    try {
      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        const data = await response.json();
        uploadStatus.innerText = `✅ Uploaded ${data.num_files} file(s) successfully.`;
      } else {
        uploadStatus.innerText = "❌ Upload failed.";
      }
    } catch (err) {
      console.error(err);
      uploadStatus.innerText = "❌ Error occurred during upload.";
    }
  });
</script>


</body>
</html>
